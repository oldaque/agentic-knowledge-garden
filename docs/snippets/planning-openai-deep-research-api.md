---
name: "Planning with OpenAI Deep Research API"
objective: "Demonstrates how to use the OpenAI Deep Research API, including how to access the final report, citations, and intermediate reasoning steps."
how_to_run: "Requires the OpenAI Python library and an API key with access to the deep research model. Run with `python your_script_name.py`."
from_note: "../patterns/planning.md"
---

# Planning with OpenAI Deep Research API

This snippet shows how to use the OpenAI Deep Research API. It not only generates a comprehensive report but also provides introspection into the agent's process, including inline citations and intermediate steps like reasoning and tool calls.

## Code Example

```python
from openai import OpenAI

client = OpenAI(api_key="YOUR_OPENAI_API_KEY")

system_message = """You are a professional researcher preparing a structured, data-driven report.
Focus on data-rich insights, use reliable sources, and include inline citations."""
user_query = "Research the economic impact of semaglutide on global healthcare systems."

response = client.responses.create(
    model="o3-deep-research-2025-06-26",
    input=[
        {
            "role": "developer",
            "content": [{"type": "input_text", "text": system_message}]
        },
        {
            "role": "user",
            "content": [{"type": "input_text", "text": user_query}]
        }
    ],
    reasoning={"summary": "auto"},
    tools=[{"type": "web_search_preview"}]
)

final_report = response.output[-1].content[0].text
print(final_report)

# --- ACCESS INLINE CITATIONS AND METADATA ---
print("--- CITATIONS ---")
annotations = response.output[-1].content[0].annotations

if not annotations:
    print("No annotations found in the report.")
else:
    for i, citation in enumerate(annotations):
        # The text span the citation refers to
        cited_text = final_report[citation.start_index:citation.end_index]

        print(f"Citation {i+1}:")
        print(f"    Cited Text: {cited_text}")
        print(f"    Title: {citation.title}")
        print(f"    URL: {citation.url}")
        print(f"    Location: chars {citation.start_index}â€“{citation.end_index}")
print("\n" + "="*50 + "\n")

# --- INSPECT INTERMEDIATE STEPS ---
print("--- INTERMEDIATE STEPS ---")

# 1. Reasoning Steps: Internal plans and summaries generated by the model.
try:
    reasoning_step = next(item for item in response.output if item.type == "reasoning")
    print("\n[Found a Reasoning Step]")
    for summary_part in reasoning_step.summary:
        print(f"    - {summary_part.text}")
except StopIteration:
    print("\nNo reasoning steps found.")

# 2. Web Search Calls: The exact search queries the agent executed.
try:
    search_step = next(item for item in response.output if item.type == "web_search_call")
    print("\n[Found a Web Search Call]")
    print(f"    Query Executed: '{search_step.action['query']}'")
except StopIteration:
    print("\nNo web search steps found.")

# 3. Code Execution: Any code run by the agent using the code interpreter.
try:
    code_step = next(item for item in response.output if item.type == "code_interpreter_call")
    print("\n[Found a Code Execution Step]")
    print("    Code Input:")
    print(f"    ```python\n{code_step.input}\n    ```")
    print("    Code Output:")
    print(f"    {code_step.output}")
except StopIteration:
    print("\nNo code execution steps found.")
```

## How It Works

1.  **API Call**: The `client.responses.create` method is called with the specified deep research model. The `reasoning={"summary": "auto"}` parameter is crucial for enabling the model to expose its intermediate steps.
2.  **Final Report**: The main output is extracted from the last item in the `response.output` list.
3.  **Citations**: The `annotations` attribute of the final output contains a list of citations, including the cited text, URL, and its position in the report.
4.  **Intermediate Steps**: The `response.output` list contains not just the final answer but also objects representing the agent's internal process. The code iterates through this list to find and inspect:
    *   **Reasoning Steps**: The model's internal monologue and planning.
    *   **Web Search Calls**: The exact queries sent to the search tool.
    *   **Code Execution**: Any code run by the code interpreter tool.
This provides a high degree of transparency into the agent's workflow.